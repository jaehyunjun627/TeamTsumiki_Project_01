-- ================================================================================
--                         Oracle 테이블 생성 스크립트
-- ================================================================================

-- 기존 테이블 삭제 (있을 경우)
-- attendance가 account를 참조하므로 attendance 먼저 삭제
DROP TABLE attendance PURGE;
DROP TABLE account PURGE;

-- ================================================================================
-- 1. 회원 테이블 (account)
-- ================================================================================
-- userID      : 아이디 (이메일 형식), 기본키
-- userPW1     : 비밀번호
-- userPW2     : 비밀번호 확인
-- email       : 이메일
-- phone       : 전화번호 (선택 입력)
-- nickname    : 닉네임
-- regDate     : 가입일 (자동으로 현재 날짜 입력)
-- ================================================================================
CREATE TABLE account (
    userID VARCHAR2(50) PRIMARY KEY,
    userPW1 VARCHAR2(100) NOT NULL,
    userPW2 VARCHAR2(100) NOT NULL,
    email VARCHAR2(100) NOT NULL,
    phone VARCHAR2(20),
    nickname VARCHAR2(50) NOT NULL,
    regDate DATE DEFAULT SYSDATE
);

-- ================================================================================
-- 2. 출석 테이블 (attendance)
-- ================================================================================
-- userID      : 회원 아이디 (account 테이블 참조)
-- attend_date : 출석 날짜
-- PK          : userID + attend_date (같은 날 중복 출석 불가)
-- FK          : userID는 account 테이블의 userID 참조
-- ================================================================================
CREATE TABLE attendance (
    userID VARCHAR2(50),
    attend_date DATE,
    PRIMARY KEY (userID, attend_date),
    FOREIGN KEY (userID) REFERENCES account(userID)
);

COMMIT;

-- 데이터 확인용
SELECT * FROM account;
SELECT * FROM attendance;

-- ================================================================================
--                              출석 데이터 예시
-- ================================================================================
-- userID              | attend_date
-- --------------------|------------
-- test@test.com       | 2026-02-01
-- test@test.com       | 2026-02-02
-- test@test.com       | 2026-02-05
-- hello@gmail.com     | 2026-02-01
-- ================================================================================

-- ================================================================================
--                              출석 체크 로직
-- ================================================================================
-- ★ 출석 조건: 로그인만으로는 출석 X, 섹터 학습 완료해야 출석 O
--
-- [흐름]
-- 1. 회원 로그인
-- 2. 메인 화면 → N5~N1 선택 → 섹터 선택
-- 3. 한자 학습 (섹터 내 한자 전부 보기)
-- 4. 학습 완료 시 → attendance 테이블에 오늘 날짜 INSERT
-- 5. 메인 화면 캘린더 → 출석한 날: 초록색 / 안 한 날: 빨간색
-- ================================================================================

-- ================================================================================
--                         출석 캘린더 색상 규칙
-- ================================================================================
-- 날짜              | 조건                    | 색상
-- ------------------|-------------------------|--------
-- 가입일 이전       | 회원 아니었음           | 회색
-- 가입일 ~ 어제     | 출석 O                  | 초록색
-- 가입일 ~ 어제     | 출석 X                  | 빨간색
-- 오늘             | 출석 O (학습 완료)       | 초록색
-- 오늘             | 출석 X (아직 학습 안 함) | 회색
-- 미래 (내일 이후)  | -                       | 회색
-- ================================================================================

-- ================================================================================
-- [예시: 오늘이 2월 5일, 가입일이 2월 3일인 경우]
-- 2월 1일: 가입 전 → 회색
-- 2월 2일: 가입 전 → 회색
-- 2월 3일 (가입일): 출석함 → 초록색
-- 2월 4일: 출석 안 함 → 빨간색
-- 2월 5일 (오늘): 아직 학습 안 함 → 회색
-- 2월 6일~28일: 미래 → 회색
-- ================================================================================